#!/bin/sh
set -e
set -o pipefail

echo "üîç Running pre-commit checks..."

ALL_STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM)
echo "üìÇ All staged files:"
echo "$ALL_STAGED_FILES"

LINT_FILES=$(echo "$ALL_STAGED_FILES" | grep -E '\.(ts|js|tsx|jsx|vue)$' | grep -v 'cypress/support/index.d.ts' || true)
echo "üìÅ Lintable files:"
echo "$LINT_FILES"

ESLINT_EXIT_CODE=0

if [ -n "$LINT_FILES" ]; then
  echo "üîß Running ESLint..."
  npx eslint $LINT_FILES || ESLINT_EXIT_CODE=$?
  echo "ESLint exit code: $ESLINT_EXIT_CODE"
else
  echo "‚ÑπÔ∏è No JS/TS files to lint."
fi

if [ $ESLINT_EXIT_CODE -ne 0 ]; then
  echo "‚ùå Commit blocked due to ESLint errors."
  exit 1
fi

echo "‚úÖ All checks passed."
exit 0
